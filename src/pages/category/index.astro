---
import Layout from "../../layouts/Layout.astro";
import CategoryCard from "../../components/CategoryCard.astro";
import { getAllReviews } from "../../utils/api";
import { allReviewsMappedToLocationAndCuisine } from "../../utils/mappers";
import {
  capitalize,
  toCamelCaseAndRemoveSpecialChars,
} from "../../utils/string";

const res = await getAllReviews();

const reduceToCuisineAndLocation = allReviewsMappedToLocationAndCuisine(res);

const cuisineCategories = Object.keys(reduceToCuisineAndLocation.cuisines)
  .map((cuisine) => ({
    name: cuisine,
    count: reduceToCuisineAndLocation.cuisines[cuisine].length,
  }))
  .sort((a, b) => {
    // Sort by name alphabetically
    return a.name.localeCompare(b.name);
  });

const locationCategories = Object.keys(reduceToCuisineAndLocation.locations)
  .map((location) => ({
    name: location,
    count: reduceToCuisineAndLocation.locations[location].length,
  }))
  .sort((a, b) => {
    // Sort by name alphabetically
    return a.name.localeCompare(b.name);
  });

const count = res.reviews.length;
---

<Layout title="Restaurant Categories - Melbourne Food Blog">
  <div class="page-header">
    <div class="container">
      <h1 class="page-title">Restaurant Categories</h1>
      <p class="page-subtitle">
        Explore restaurants by cuisine type or location
      </p>
    </div>
  </div>

  <div class="page-content">
    <div class="container">
      <!-- Cuisine Categories -->
      <section class="category-section">
        <div class="section-header">
          <h2 class="section-title">Cuisine Types</h2>
          <p class="section-subtitle">
            Discover restaurants by the type of cuisine they serve
          </p>
        </div>

        <div class="grid grid--4-cols">
          {
            cuisineCategories.map((category) => (
              <CategoryCard
                name={capitalize(category.name)}
                type="cuisine"
                count={category.count}
                href={`/category/cuisine/${toCamelCaseAndRemoveSpecialChars(category.name)}`}
              />
            ))
          }
        </div>
      </section>

      <!-- Location Categories -->
      <section class="category-section">
        <div class="section-header">
          <h2 class="section-title">Locations</h2>
          <p class="section-subtitle">
            Find restaurants in your favorite Melbourne suburbs
          </p>
        </div>

        <div class="grid grid--4-cols">
          {
            locationCategories.map((category) => (
              <CategoryCard
                name={category.name}
                type="location"
                count={category.count}
                href={`/category/location/${category.name.toLowerCase().replace(/\s+/g, "-")}`}
              />
            ))
          }
        </div>
      </section>

      <!-- Quick Stats -->
      <section class="stats-section">
        <div class="grid grid--3-cols">
          <div class="stat-card">
            <div class="stat-number">{cuisineCategories.length}</div>
            <div class="stat-label">Cuisine Types</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">{locationCategories.length}</div>
            <div class="stat-label">Locations</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">
              {count}
            </div>
            <div class="stat-label">Total Reviews</div>
          </div>
        </div>
      </section>
    </div>
  </div>
</Layout>

<style>
  .page-header {
    background-color: var(--color-gray-50);
    padding: var(--spacing-12) 0;
    border-bottom: 1px solid var(--color-gray-200);
  }

  .page-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--spacing-4);
    text-align: center;
  }

  .page-subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-gray-600);
    text-align: center;
    margin: 0;
  }

  .page-content {
    padding: var(--spacing-12) 0;
  }

  .category-section {
    margin-bottom: var(--spacing-16);
  }

  .section-header {
    text-align: center;
    margin-bottom: var(--spacing-12);
  }

  .section-title {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--spacing-4);
    color: var(--color-gray-900);
  }

  .section-subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-gray-600);
    margin: 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .stats-section {
    background-color: var(--color-gray-50);
    border-radius: var(--radius-lg);
    padding: var(--spacing-12);
    margin-top: var(--spacing-16);
  }

  .stat-card {
    text-align: center;
    background-color: var(--color-white);
    padding: var(--spacing-8);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-gray-200);
    box-shadow: var(--shadow-sm);
  }

  .stat-number {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin-bottom: var(--spacing-2);
  }

  .stat-label {
    font-size: var(--font-size-lg);
    color: var(--color-gray-600);
    font-weight: var(--font-weight-medium);
  }
</style>
